var unCheckAll = function( strElementId, intElementCount, htmlElement ) {

	intElementCount++;

	for( intCounter = 0; intCounter < intElementCount; intCounter++ ) {
		$( '#' + strElementId + '_' + intCounter ).prop( 'checked', false );
	}

	htmlElement.checked = true;

	$( '#' + strElementId ).text( $( '#label_' + htmlElement.id ).html() );
};

var unCheckAllOptions = function( strElementId, intElementCount, strMessage ) {
	for( i = 1; i <= intElementCount; i++ ) {
		document.getElementById( strElementId + '_' + i ).checked = false;
	}

	document.getElementById( strElementId ).innerHTML = strMessage;
};

var CheckAllOptions = function( strElementId, intElementCount, strMessage ) {
	for( i = 1; i <= intElementCount; i++ ) {
		document.getElementById( strElementId + '_' + i ).checked = true;
	}

	document.getElementById( strElementId ).innerHTML = strMessage;
};
var toggleText = function ( strElementId, intElementCount, strMessage ) {

	var intTotalSelected		= 0;
	var strFirstElementId		= '#' + strElementId + '_0';
	var strSelectedOptionSpanId	= '#' + strElementId;

	$( strFirstElementId ).prop( 'checked', false );

	for( intCounter = 1; intCounter <= intElementCount; intCounter++ ) {

		if( true == $( '#' + strElementId + '_' + intCounter ).prop( 'checked' ) ) {
			intTotalSelected = intTotalSelected + 1;
		}

		if( 2 <= intTotalSelected ) {
			$( strSelectedOptionSpanId ).text( __('Multiple') );
		}
	}

	// If a single item is selected, put that items label in the visible display area
	if( 1 == intTotalSelected ) {

		for( intCounter = 1; intCounter <= intElementCount; intCounter++ ) {

			if( true == $( '#' + strElementId + '_' + intCounter ).prop( 'checked' ) ) {
				$( strSelectedOptionSpanId ).text( $( '#txt_' + strElementId + '_' + intCounter ).html() );
			}
		}
	}

	if( 0 == intTotalSelected ) {
		$( strFirstElementId ).prop( 'checked', true );
		$( strSelectedOptionSpanId ).text( strMessage );
	}

	// If all single item is selected, put All select in the visible display area
	if( intElementCount == intTotalSelected ) {

		for( var intCounter = 1; intCounter <= intElementCount; intCounter++ ) {
			$( '#' + strElementId + '_' + intCounter ).prop( 'checked', false );
		}

		$( strFirstElementId ).prop( 'checked', true );
		$( strSelectedOptionSpanId ).text( strMessage );
	}
};

var loadAssets = function() {
	if( true == $( '#fixed_assets_list_tab' ).parent('li').hasClass('selected') ) {

		psi.patterns.ajaxRequest( { strElementSelector: '#body', url: psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'] + '&is_switch_tab=1' } );

		psi.patterns.pushState( {
			strElementSelector: '#body',
			tabId: '#inventory_tab',
			url: psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'],
		}, null, psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'] );

	} else if( true == $( '#inventory_tab' ).parent('li').hasClass('selected') ) {

		psi.patterns.ajaxRequest( { strElementSelector: '#body', url: psi.objViewAssetsListSystem.arrstrExitTags['view_inventories'] + '&is_switch_tab=1' } );

		psi.patterns.pushState( {
			strElementSelector: '#body',
			tabId: '#inventory_tab',
			url: psi.objViewAssetsListSystem.arrstrExitTags['view_inventories'],
		}, null, psi.objViewAssetsListSystem.arrstrExitTags['view_inventories'] );
	}
};

psi.objViewAssetsListSystem = ( function() {

	var arrstrExitTags = {};

	var sortFixedAssets = function( strFieldName, strSortDirection ) {

		var intFilterCount = $( '#asset_list_filter_count' ).val();
		var strSortDirection = $( '#sort_direction' ).val();

		if( 0 != intFilterCount ) {

			if( 'DESC' == strSortDirection ) {
				strSortDirection = 'ASC';
			} else {
				strSortDirection = 'DESC';
			}

			$( '#sort_direction' ).val( strSortDirection );
			$( '#sort_by' ).val( strFieldName );
			psi.patterns.ajaxRequest( {
				strElementSelector: '#viewFixedAssetsListAndInventory',
				url: psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'] + '&asset_list_filter[sort_direction]=' + strSortDirection + '&asset_list_filter[sort_by]=' + strFieldName,
				data: $( '#frm_search_asset_lists' ).serialize( true )
			} );
		}
	};

	var reloadTabs = function() {
		$( '#inventory_tab' ).bind( "click", function() {

			psi.patterns.ajaxRequest( { strElementSelector: '#body', url: psi.objViewAssetsListSystem.arrstrExitTags['view_inventories'] + '&is_switch_tab=1' } );

			psi.patterns.pushState( {
				strElementSelector: '#body',
				tabId: $(this).attr( 'id' ),
				url: psi.objViewAssetsListSystem.arrstrExitTags['view_inventories'],
			}, null, psi.objViewAssetsListSystem.arrstrExitTags['view_inventories'] );

			$('#add_fixed_assets_transaction').parent('li').hide();

			$(this).parent('li').addClass('selected');
			$('#fixed_assets_list_tab').parent('li').removeClass('selected');

			$( '<i class="view-data-close js-view-data-close"></i>' ).insertAfter( '#view-data-filters #heading' );
		});

		$( '#fixed_assets_list_tab' ).bind( "click", function() {
			psi.patterns.ajaxRequest( { strElementSelector: '#body', url: psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'] + '&is_switch_tab=1',
				success:function( response ) {
					try{
						var parsedDaata = jQuery.parseJSON( response );
						if( true == parsedDaata.hasOwnProperty( 'redirect' ) ) {
							document.location.replace( parsedDaata['redirect'] );
						}
					} catch( e ) {
						$('#body').html( response );
					}
				}
			} );

			psi.patterns.pushState( {
				strElementSelector: '#body',
				url: psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'],
			}, null, psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'] );

			$(this).parent('li').addClass('selected');
			$('#inventory_tab').parent('li').removeClass('selected');
			$( '<i class="view-data-close js-view-data-close"></i>' ).insertAfter( '#view-data-filters #heading' );
		} );

		$(document).on("click","#export_asset_list",  function () {

			$strUrl = psi.objViewAssetsListSystem.arrstrExitTags['export_inventory_list'];

			if( true == $(this).data('is-from-fixed-asset') ) {
				$strUrl = psi.objViewAssetsListSystem.arrstrExitTags['export_fixed_asset_list'];
				psi.patterns.showLoadingImage( { strElementSelector: '#viewFixedAssetsListAndInventory' } );

				psi.patterns.ajaxRequest({
					strElementSelector: '#viewFixedAssetsListAndInventory',
					url: psi.objViewAssetsListSystem.arrstrExitTags['load_filtered_fixed_asset_export_data'],
					data: $('#frm_search_asset_lists').serialize(),
					success: function ( responseData ) {

						var responseArr = $.parseJSON(responseData);

						if( true === responseArr.response ) {
							psi.patterns.removeLoadingImage( { strElementSelector: '#viewFixedAssetsListAndInventory' } );
							window.location.href = $strUrl;
						}
					}
				});
			} else {
				window.location.href = $strUrl;
			}
		});

		$(document).on("click","#print_button",  function () {
			printContent('printGridContent','tab_container_print.css',true,'','');
		});
	};

	var init = function() {

		psi.patterns.bindEssentials();

		$('.view-data-side-tabs #search-icon').click(function() {

			if( true == $( '#fixed_assets_list_tab' ).parent('li').hasClass('selected') ) {

				$( '#view-data-filters #heading' ).text( __('Fixed Asset Filter') );
				$( '<i class="view-data-close js-view-data-close"></i>' ).insertAfter( '#view-data-filters #heading' );
			} else if( true == $( '#inventory_tab' ).parent('li').hasClass('selected') ) {

				$( '#view-data-filters #heading' ).text( __('Inventory Filter') );
				$( '<i class="view-data-close js-view-data-close"></i>' ).insertAfter( '#view-data-filters #heading' );
			}

		} );

		$('.view-data-side-tabs #search-icon').mouseover(function() {
			if( true == $( '#fixed_assets_list_tab' ).parent('li').hasClass('selected') ) {
				$( this ).prop( 'title', __('Fixed Asset Filter'));
			} else if( true == $( '#inventory_tab' ).parent('li').hasClass('selected') ) {
				$( this ).prop( 'title', __('Inventory Filter'));
			}
		} );

		// run this code once ajax reponse added into DOM to make equal height of sidebar and content
		psi.patterns.setEqualHeights( {
			elementSelector: ".equal-heights"
		} );

		// !Search Option Functions
		$( '.js-add-search-options' ).psiTooltip( {
			tooltipClass: 'search-options',
			trigger: 'click',
			contentSelector: $( '.search-options' ),
			positions: 'bottom',
			items: '.js-add-search-options',
			clickAnywhereToClose: true,
			open: function( event, ui ){
				bindEssentials();

				var type = $( '.js-entity-search-options' ).val();

				$( '.search-ops-list' ).each( function() {
					var $this = $( this );

					if( $this.hasClass( type ) ) {
						$this.removeClass( 'hide' );
					} else {
						$this.addClass( 'hide' );
					}
				} );
			}
		});

		$( 'body' ).on( 'change', '.js-entity-type-list', function ( e ) {
				//get the selected option's text and store it in map
				var map = $( '.js-entity-type-list :selected' ).map( function () {
					var txt = $( this ).text();
					//do not add the value to map[] if the chosen value begins with "Select"
					return txt.indexOf( '.js-entity-type-list' ) === -1 ? txt + "  " : "";
				} ).get();
				//add it to div
				$( '.js-write-entity' ).html( map );
			} )
			.on( 'click', '.js-add-options', function( e ) {
				e.preventDefault();
				$( '.additional-search-block' ).fadeIn( 'fast' );
				$( '.js-add-search-options' ).psiTooltip( 'close' );

			} )
			.on( 'click', '.js-cancel-btn', function( e ) {
				e.preventDefault();
				$( '.js-add-search-options' ).psiTooltip( 'close' );
			} )
			.on( 'click', '.js-delete-field', function( e ) {
				$(this).closest(".additional-search-block").fadeOut("fast");
			})

			.on("click", ".js-view-data-submit",function(){
				$(".view-data-filters").promise().done(function(){
					$(".generated-report").hide().delay(500).effect("fade",500);
				})

			} );

		// !Doc List Functions
		$( '.doc-list' )
			.on( 'click', "input[type='checkbox']", function( e ){
				e.stopPropagation();
			})

			.on( 'click', ".accordion-embedded .head", function( event ){
				$( '.view-data-content' ).attr( 'style','' );
				setTimeout( function(){
					psi.patterns.setEqualHeights( {
						elementSelector: '.equal-heights' } );
					}, 250);
			} )
			.on( 'click', '.accordion-embedded .level2 .body .doc-name-row', function( e ){
				$( this ).addClass( 'selected' );
				$( '.preview-placeholder' ).hide();
				$( this ).siblings( 'div' ).removeClass( 'selected' );
				$( '.list-preview-item' ).removeClass( 'hide' ).fadeIn( 'fast' );
			});

		// !Common Functions
		$( 'body' )
			.on( 'click', '.js-add-to-export', function( e ) {

				$( '.js-export-list-link' )
					.stop()
					.switchClass('white', 'subtle-gray', 150)
					.delay( 150 )
					.switchClass( 'subtle-gray', 'highlight-green', 1000 )
					.delay(1150)
					.switchClass( 'highlight-green', 'white', 1000 );
			} );

		$( '#ap_code_id' ).parent().addClass('left');

		jQuery( '#search_inventory_ap_code_id' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_ap_code_by_asset_type',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'ap_code_name';
				this.data['show_item_Type_of']					= 'inventory';
			},
			onRowClick: function( objRowData ) {
				psi.objViewAssetsListSystem.clickHandlerInventoryApCodeName( objRowData, '#search_inventory_ap_code_id' );
			}
		});
		$( '#search_inventory_ap_code_id' ).parent().addClass('left');

	};

	var clickHandlerApCodeName = function( obj, container ) {

		var strApCodeName = __('Select Catalog Item');

		if( null != obj.name ) {
			strApCodeName = $("<div />").html(obj.name).text();
		}

		$( container ).val( strApCodeName );
		$( container ).focus();
		$( '#default_ap_code_id' ).val( obj.id );
	};

	var clickHandlerInventoryApCodeName = function( obj, container ) {

		var strApCodeName = __('Select Catalog Item');

		if( null != obj.name ) {
			strApCodeName = $("<div />").html(obj.name).text();
		}

		$( container ).val( strApCodeName );
		$( container ).focus();
		$( '#default_search_inventory_ap_code_id' ).val( obj.id );
	};

	return { init								:init,
			reloadTabs							:reloadTabs,
			arrstrExitTags						:arrstrExitTags,
			clickHandlerApCodeName				:clickHandlerApCodeName,
			clickHandlerInventoryApCodeName		:clickHandlerInventoryApCodeName
	};

} )();

psi.objAssetListSearch = ( function() {

	var arrstrExitTags	= {};
	var action			= '';

	var init = function() {

		psi.patterns.bindEssentials();

		$(".view-data-side-tabs").on("click", "#inventory_bulk_transfer", function( e ) {
			psi.patterns.loadLargeDialog( {
				class:'scroll-auto',
				title: __('Bulk Transfer Inventory'),
				strContentId:'inventory_bulk_transfer_container',
				strUrl: psi.objAssetListSearch.arrstrExitTags.inventory_bulk_transfer
			} );
		} );

		//For Asset Type Multi Select
		var intTotalTypes			= $( '#fixed_asset_search_asset_type_count' ).val();
		var intSelectedTypeCount	= $( '#asset_list_filter_asset_type_count' ).val();

		if( 1 < intSelectedTypeCount ) {
			$( '#asset_list_filter_asset_type_id' ).text( __('Multiple') );
		} else if( 1 == intSelectedTypeCount ) {
			$( '#asset_list_filter_asset_type_id' ).text( $( '#asset_type_name' ).val() );
		}

		if( true === $('#asset_list_filter_asset_type_id_0').prop('checked') ) {
			CheckAllOptions( 'asset_list_filter_asset_type_id', intTotalTypes, __('All Types') );
		} else if( false === $('#asset_list_filter_asset_type_id_0').prop('checked') ) {
			unCheckAllOptions( 'asset_list_filter_asset_type_id', intTotalTypes, __( 'All Types' ) );
		}

		$( 'input[id^="asset_list_filter_asset_type_id_"]' ).click( function() {

			var intElementId = $( this ).attr( 'id' ).replace( 'asset_list_filter_asset_type_id_', '' );

			if( 0 != intElementId ) {
				toggleText( 'asset_list_filter_asset_type_id', intTotalTypes, __('All Types') );
			}
		} );

		//For Asset status Multi Select

		$( '#asset_list_filter_status_id' ).html( __('Multiple') );
		$( '#asset_list_filter_status_id_0').prop( 'checked', false );
		$( '#asset_list_filter_status_id_1').prop( 'checked', true );
		$( '#asset_list_filter_status_id_2').prop( 'checked', true );

		var intTotalStatus			= $( '#fixed_asset_search_asset_status_count' ).val();
		var intSelectedStatusCount	= $( '#asset_list_filter_asset_status_count' ).val();

		if( 1 < intSelectedStatusCount ) {
			$( '#asset_list_filter_status_id' ).text( __('Multiple') );
		} else if( 1 == intSelectedStatusCount ) {
			$( '#asset_list_filter_status_id' ).text( $( '#asset_status_name' ).val() );
		}

		$( 'input[id^="asset_list_filter_status_id_"]' ).click( function() {

			var intElementStatusId = $( this ).attr( 'id' ).replace( 'asset_list_filter_status_id_', '' );

			if( 0 != intElementStatusId ) {
				toggleText( 'asset_list_filter_status_id', intTotalStatus, __('All Statuses') );
			}
		} );

		//For Depreciation Categories Multi Select
		var intTotalCategories			= $( '#fixed_asset_search_depreciation_categories_count' ).val();
		var intSelectedCategoriesCount	= 0;

		if( true === $('#depreciation_category_list_0').prop('checked') ) {
			CheckAllOptions( 'depreciation_category_list', intTotalCategories, __('All categories') );
		} else if( false === $('#depreciation_category_list_0').prop('checked') ) {
			unCheckAllOptions( 'depreciation_category_list_', intTotalCategories, __( 'All categories' ) );
		}

		for( intCounter = 1; intCounter <= intTotalCategories; intCounter++ ) {
			if( true == $( '#depreciation_category_list_' + intCounter ).prop( 'checked' ) ) {
				intSelectedCategoriesCount = intSelectedCategoriesCount + 1;
			}
		}
		if( intTotalCategories == intSelectedCategoriesCount) {
			$( '#depreciation_category_list' ).text( __('All categories') );
		} else if( 1 < intSelectedCategoriesCount ) {
			$( '#depreciation_category_list' ).text( __('Multiple') );
		} else if( 1 == intSelectedCategoriesCount ) {
			for( intCounter = 1; intCounter <= intTotalCategories; intCounter++ ) {
				if( true == $( '#depreciation_category_list_' + intCounter ).prop( 'checked' ) ) {
					$( '#depreciation_category_list' ).text( $('#txt_depreciation_category_list_' + intCounter ).text() );
					break;
				}
			}
		}

		// To disable depreciation Categories List for Fixed Asset (Expensed & Tracked) type
		$( 'input[id^="asset_list_filter_asset_type_id_"]' ).click( function() {
			if( false === $('#asset_list_filter_asset_type_id_1').prop('checked') && true === $('#asset_list_filter_asset_type_id_2').prop('checked') ) {
				$( 'input[id^="depreciation_category_list_"]' ).prop('checked', false);
				$("#depreciation_category_list").closest("div").addClass( "disabled" );
			} else {
				$( 'input[id^="depreciation_category_list_"]' ).prop('checked', true);
				$( '#depreciation_category_list' ).text( __('All categories') );
				$("#depreciation_category_list").closest("div").removeClass( 'disabled' );
			}
		});

		$( 'input[id^="depreciation_category_list_"]' ).click( function() {

			var intElementStatusId = $( this ).attr( 'id' ).replace( 'depreciation_category_list_', '' );

			if( 0 != intElementStatusId ) {
				toggleText( 'depreciation_category_list', intTotalCategories, __('All categories') );
			}
		} );

		// Category search
		if( true == $('#ap_code_category_list_id_0').prop("checked") ) {
			$( '[id^=ap_code_category_list_id_]' ).each(function() {
				$( this ).prop( 'checked', true );
			});
		}

		// inventory type search
		if( true == $('#inventory_asset_list_filter_asset_type_id_0').prop("checked") ) {
			$( '[id^=inventory_asset_list_filter_asset_type_id_]' ).each(function() {
				$( this ).prop( 'checked', true );
			});
		}

		$( '#asset_units_search' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_asset_units',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			template: $('#entrata_quick_search_template').html(),
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'fixed_assets_units';
				this.data['show_item_type_of']					= 'inventory';
			},
			onRowClick: function( objRowData ) {
				psi.objAssetListSearch.clickHandlerAssetUnitsSearch( objRowData, '#asset_units_search' );
			}
		});
	};

	var resetForm = function( strFormId ) {

		var objForm = $( '#' + strFormId );
		$( ':input', objForm ).each( function() {
			var strType = this.type;
			var strTag = this.tagName.toLowerCase();

			switch( strType ) {
				case 'text':
				case 'password':
				case 'textarea':
				case 'hidden':
					this.value = '';
					break;
				case 'checkbox':
				case 'radio':
					this.checked = false;
					break;
				default:
					if( 'select' == strTag ) {
						this.selectedIndex = 0;
					}
			}
		} );

		$( '#js-clear-all-properties' ).addClass( 'disabled' );
		$( '#asset_list_filter_asset_type_id' ).html( __('All Types') );
		$( '#asset_list_filter_asset_type_id_0').prop( 'checked', true );
		$( '#asset_list_filter_asset_type_id_1').prop( 'checked', true );
		$( '#asset_list_filter_asset_type_id_2').prop( 'checked', true );

		$( '#asset_list_filter_status_id' ).html( __('Multiple') );
		$( '#asset_list_filter_status_id_1').prop( 'checked', true );
		$( '#asset_list_filter_status_id_2').prop( 'checked', true );

		$( '#depreciation_category_list' ).html( __('All Categories') );
		$( '#depreciation_category_list_0').prop( 'checked', true );

		var intTotalCategories			= $( '#fixed_asset_search_depreciation_categories_count' ).val();
		if( true === $('#depreciation_category_list_0').prop('checked') ) {
			CheckAllOptions( 'depreciation_category_list', intTotalCategories, __('All categories') );
		} else if( false === $('#depreciation_category_list_0').prop('checked') ) {
			unCheckAllOptions( 'depreciation_category_list_', intTotalCategories, __( 'All categories' ) );
		}
		//for reset depreciation category
		$("#depreciation_category_list").closest("div").removeClass( 'disabled' );
		// reset inventory asset list filter
		$( '#inventory_asset_list_filter_asset_type_id' ).html( __('All Types') );
		$( '[id^=inventory_asset_list_filter_asset_type_id_]' ).each(function() {
			$( this ).prop( 'checked', true );
		});

		$('#ap_code_category_id').prop('selectedIndex',0);
		$('#name').prop('asset_location_id',0);

		$('#frm_search_asset_lists li').css('display', '');

		$( '[id^=selected-asset_list_filterproperty_ids]' ).each(function() {
			$( this ).remove();
		});
		//show back properties in right pannel
		$('[id^=asset_list_filterproperty_ids_properties_]').children().show();

		$('.switch-button').removeClass('slim on').addClass('slim off');
		$('.switch-button span').text('Off');
		$('.switch-button b').css('left', '1px');
		$('#show_zero_qnt').val(0);

		// category search
		$( '#ap_code_category_list_id' ).html( __('All Categories') );
		$( '[id^=ap_code_category_list_id]' ).each(function() {
			$( this ).prop( 'checked', true );
		});

		return true;
	};

	var clickHandlerAssetUnitsSearch = function(obj, container ) {
		var strUnitNumber = __('Select Asset Units');

		$( container ).val( strUnitNumber );

		if( null != obj.unit_number ) {
			strUnitNumber = obj.unit_number + obj.space_number;
		}

		$( container ).val( strUnitNumber );
		$( container ).focus();

		$( '#default_unit_space_id' ).val( obj.id );
	};

	return { init					:init,
			resetForm				:resetForm,
			arrstrExitTags			:arrstrExitTags,
			action					: action,
			clickHandlerAssetUnitsSearch	:clickHandlerAssetUnitsSearch

		};

} ) ();

psi.objFixedAssets = ( function() {

	var arrstrExitTags = {};

	var fixedAssetsListing = function() {
		$( '#div-view-listing' ).off( 'click', '.fixed_asset' ).on( 'click', '.fixed_asset', function() {
			intFixedAssetId = $( this ).data( 'fixed-asset-id' );
			strExtUrl		= '&current_tab=item_info&asset_id=' + intFixedAssetId;

			psi.patterns.loadLargeDialog( {
				title: __('Item Profile'),
				strUrl: psi.objFixedAssets.arrstrExitTags.view_update_fixed_asset + strExtUrl
			} );
		} );
	};

	var fixedAssetsLazyLoad = function( url ) {
		$strElementSelector = $( '#viewFixedAssetsListAndInventory .doc-list table' );
		$strElementSelector.data( 'page_no', 2 );

		psi.patterns.lazyLoad( {
			strElementSelector: $strElementSelector,
			scrollEndValue: 80,
			url: url + '&is_scroll=1',
			data: $strElementSelector.data(),
			customBeforeSend: function() {
				$strElementSelector.data( 'page_no', $strElementSelector.data( 'page_no' ) * 1 + 1 );
			},
			success: function( res ) {
				// checking data to prevent further ajax requests
				$strElementSelector.find( ".js-loading-data" ).remove();
				$strElementSelector.append( res );

				if( $( res ).filter( 'tr' ).length >= 1 ) {
					$strElementSelector.data( 'ajax-in-process', false );
				} else {
					$strElementSelector.data( 'ajax-in-process', true );
				}
				$( '.view-data-content' ).attr( 'style','');
				$( '.view-data-left-col' ).height( $( '.view-data-content' ).height() );
			}
		} );
	};

	var clickHandlerWarrantyVendor = function( obj, container ) {

		var strPoVendor	= __('Select Purchase Order Vendor');
		var strAddress	= '';
		var strContact	= '';
		var strPhone	= '';
		var strEmail	= '';

		$( container ).val( strPoVendor );

		if( null != obj.street_line1 && '' != obj.street_line1 ) {
			strAddress = strAddress + obj.street_line1;
		}

		if( null != obj.street_line2 && '' != obj.street_line2 ) {
			strAddress = strAddress + ', ' + obj.street_line2;
		}

		if( null != obj.street_line3 && '' != obj.street_line3 ) {
			strAddress = strAddress + ', ' + obj.street_line3;
		}

		if( null != obj.company_name ) {
			strPoVendor = obj.company_name;
		}

		if( null != obj.location_name && '' != obj.location_name ) {
			strPoVendor = strPoVendor + ', ' + obj.location_name;
		}

		if( null != obj.city && '' != obj.city ) {
			strPoVendor = strPoVendor + ', ' + obj.city;
			strAddress = strAddress + '<br> ' + obj.city;
		}

		if( null != obj.state_code && '' != obj.state_code ) {
			strPoVendor = strPoVendor + ', ' + obj.state_code;
			strAddress = strAddress + ', ' + obj.state_code;
		}

		if( null != obj.postal_code && '' != obj.postal_code ) {
			strAddress = strAddress + ', ' + obj.postal_code;
		}

		if( null != obj.name_first && '' != obj.name_first ) {
			strContact = obj.name_first;
		}

		if( null != obj.name_last && '' != obj.name_last ) {
			strContact = strContact + ' ' + obj.name_last;
		}

		if( null != obj.phone_number && '' != obj.phone_number ) {
			strPhone = obj.phone_number;
		} else if( null != obj.mobile_number && '' != obj.mobile_number ) {
			strPhone = obj.mobile_number;
		}

		if( null != obj.email_address && '' != obj.email_address ) {
			strEmail = strEmail + ' ' + obj.email_address;
		}

		$( '#warranty_vendor_address' ).html( strAddress );
		$( '#warranty_vendor_contact' ).text( strContact );
		$( '#warranty_vendor_phone' ).text( strPhone );
		$( '#warranty_vendor_email' ).text( strEmail );
		$( container ).val( strPoVendor );
		$( container ).focus();
		$( '#selected_warranty_vendor_id' ).val( obj.id );
	};

	var init = function() {

		psi.patterns.bindEssentials();

		$( document ).off( 'click', '.js-item-info' ).on ( 'click', '.js-item-info', function() {
			$( '#warranty' ).addClass( 'hide' );
			$( '#history' ).addClass( 'hide' );
			$( '#depreciation' ).addClass( 'hide' );
			$( '#maintenance' ).addClass( 'hide' );
			$( '#item_info' ).removeClass( 'hide' );
		} );

		$( document ).off( 'click', '.js-warranty' ).on ( 'click', '.js-warranty', function() {
			$( '#item_info' ).addClass( 'hide' );
			$( '#history' ).addClass( 'hide' );
			$( '#depreciation' ).addClass( 'hide' );
			$( '#maintenance' ).addClass( 'hide' );
			$( '#warranty' ).removeClass( 'hide' );

		} );

		$( document ).off( 'click', '.js-history' ).on ( 'click', '.js-history', function() {
			$( '#item_info' ).addClass( 'hide' );
			$( '#warranty' ).addClass( 'hide' );
			$( '#depreciation' ).addClass( 'hide' );
			$( '#maintenance' ).addClass( 'hide' );
			$( '#history' ).removeClass( 'hide' );

			psi.patterns.ajaxRequest( {
				strElementSelector: '#history',
				url: psi.objFixedAssets.arrstrExitTags.view_asset_history + '&asset_id=' + $( '#asset_id' ).val()
			} );
		} );

		$( document ).off( 'click', '.js-maintenance' ).on( 'click', '.js-maintenance', function(){
			$( '#item_info' ).addClass( 'hide' );
			$( '#warranty' ).addClass( 'hide' );
			$( '#depreciation' ).addClass( 'hide' );
			$( '#history' ).addClass( 'hide' );
			$( '#maintenance' ).removeClass( 'hide' );
			psi.patterns.ajaxRequest( {
				strElementSelector: '#asset_maintenance',
				url: psi.objFixedAssets.arrstrExitTags.view_associated_work_orders + '&asset_id=' + $( '#asset_id' ).val()
			} );
		});

		$( document ).off( 'click', '.js-depreciation' ).on ( 'click', '.js-depreciation', function() {
			$( '#item_info' ).addClass( 'hide' );
			$( '#warranty' ).addClass( 'hide' );
			$( '#history' ).addClass( 'hide' );
			$( '#maintenance' ).addClass( 'hide' );
			$( '#depreciation' ).removeClass( 'hide' );

			psi.patterns.ajaxRequest( {
				strElementSelector: '#depreciation',
				url: psi.objFixedAssets.arrstrExitTags.view_update_depreciation + '&asset_id=' + $( '#asset_id' ).val()
			} );
		} );

		$( '.tabs-mid li' ).on ( 'click', function() {
			$( this ).addClass( 'selected' );
			$( this ).siblings().removeClass( 'selected' );
			$( '.alert.slim' ).remove();
			$( '#item_info-view, #item_info-button, #warranty_info-view, #warranty_info-button' ).removeClass( 'hide' );
			$( '#item_info-edit, #warranty_info-edit' ).addClass( 'hide' );
		} );

		// remove onclick event and added onclick function
		$('.close-button').removeAttr('onclick');
		$('.close-button').attr('id', 'fixed_asset_close');

		$( document ).off( 'click', '#fixed_asset_close').on( 'click', '#fixed_asset_close', function() {
			var isPostDepreciationFixedAssets = $("#is_post_depreciation_fixed_assets").val();

			if( 'true' == isPostDepreciationFixedAssets ) {
				psi.objPostDepreciationFixedAssets.reFreshPostDepreciationFixedAssetsTab();
			} else {
				reFreshFixedAssetsTab();
				var isbulkTransfer = $("#is_bulk_transfer");
				if( true == isbulkTransfer ) {
					psi.patterns.ajaxRequest( {
						strElementSelector: '#bulk_transfer_fixed_assets_container',
						url: psi.objFixedAssets.arrstrExitTags.view_bulk_transfer_fixed_assets,
						success: function( response ) {
							$('#bulk_transfer_fixed_assets_container').html( response );
							psi.patterns.removeLoadingImage( { strElementSelector: "#bulk_transfer_fixed_assets_container" } );

						}
					} );
				}
			}

			psi.patterns.closeLargeDialog();
		} );

		$( '#item_info-button, #item_info-cancel' ).on( 'click', function() {
			if( $( '#item_info-edit' ).is( ':visible' ) == false) {
				$( '#item_info-view' ).addClass( 'hide' );
				$( '#item_info-edit' ).removeClass( 'hide' );
				$( '#item_info-button' ).addClass( 'hide' );
				psi.patterns.stripesPattern( $( '[data-pattern=stripes]' ) )
			} else {
				$( '#item_info-edit' ).addClass( 'hide' );
				$( '#item_info-view' ).removeClass( 'hide' );
				$( '#item_info-button' ).removeClass( 'hide' );
			}
		} );

		$( '#edit_item_info' ).submit( function() {

			var strElementId = '#modal_body';

			if( $( "#modal_body2" ).length ) {
				strElementId = '#modal_body2';
			} else if( $( "#modal_body1" ).length ) {
				strElementId = '#modal_body1';
			}

			window.reloadList = 1;
			psi.patterns.ajaxRequest( { strElementSelector: strElementId, url: psi.objFixedAssets.arrstrExitTags.view_update_fixed_asset + '&asset_id=' + $( '#asset_id' ).val(), data: $( '#edit_item_info' ).serialize() } );
			return false;
		} );

		$( '#edit_warranty_info' ).submit( function() {

			var strElementId = '#modal_body';

			if( $( "#modal_body2" ).length ) {
				strElementId = '#modal_body2';
			} else if( $( "#modal_body1" ).length ) {
				strElementId = '#modal_body1';
			}

			window.reloadList = 1;
			psi.patterns.ajaxRequest( { strElementSelector: strElementId, url: psi.objFixedAssets.arrstrExitTags.view_update_fixed_asset + '&asset_id=' + $( '#asset_id' ).val(), data: $( '#edit_warranty_info' ).serialize() } );
			return false;
		} );

		$( '#warranty_info-button, #warranty_info-save, #warranty_info-cancel' ).on( 'click', function() {
			if( $( '#warranty_info-edit' ).is( ':visible' ) == false) {
				$( '#warranty_info-view' ).addClass( 'hide' );
				$( '#warranty_info-edit' ).removeClass( 'hide' );
				$( '#warranty_info-button' ).addClass( 'hide' );
				psi.patterns.stripesPattern( $( '[data-pattern=stripes]' ) )
			} else {
				$( '#warranty_info-edit' ).addClass( 'hide' );
				$( '#warranty_info-view' ).removeClass( 'hide' );
				$( '#warranty_info-button' ).removeClass( 'hide' );
			}
		} );

		$( '.view_asset_invoice' ).off('click').on( 'click', function() {
			intApHeaderId = $( this ).data( 'ap-header-id' );

			if( false == isNaN( intApHeaderId ) ) {
				psi.patterns.addDialogContent( {
					strUrl: psi.objFixedAssets.arrstrExitTags.view_invoice + '&ap_header[id]=' + intApHeaderId,
					title: __('Item Invoice')
				} );
			}

		} );

		$( '#warranty_ap_payees_dropdown' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_warranty_vendors',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']			= 'vendors_with_warranty_contacts';
				this.data['fast_lookup_filter[allocation_method_id]']	= $( '#invoice_allocation_type' ).val()
			},
			onRowClick: function( objRowData ) {
				psi.objFixedAssets.clickHandlerWarrantyVendor( objRowData, '#warranty_ap_payees_dropdown' );
			}
		});
		$( '#warranty_ap_payees_dropdown' ).parent().addClass('left');

		$( '#warranty_ap_payees_dropdown' ).on( 'blur', function() {
			if( '' == $( this ).val() ) {
				$( '#selected_warranty_vendor_id' ).val( '' );
			}
		} );

		$( '#add_vendor' ).on( 'click', function() {
			psi.patterns.loadDialog( { width: 600, height: 460, strUrl: psi.objFixedAssets.arrstrExitTags.quick_add_vendor, strContentId: 'quick_add_vendor', title: __('Create New Vendor') } );
			return false;
		});

		$( '#create_retire_item_button' ).off('click').on( 'click', function() {
			var intAssetId			= $( this).attr( 'data-asset-id' );
			var intAssetDetailId	= $( this).attr( 'data-asset-detail-id' );
			psi.patterns.loadDialog({
					width:'550',
					height:'340',
					strUrl:psi.objFixedAssets.arrstrExitTags['create_retire_item'] + '&asset_detail[asset_id]=' + intAssetId + '&asset_detail[id]=' + intAssetDetailId,
					strContentId:'create-retire-item',
					title: __('Retire Item')
				});
		} );

		$( '#update_unretire_item_button' ).on( 'click', function() {
			var intAssetId			= $( this).attr( 'data-asset-id' );
			var intAssetDetailId	= $( this).attr( 'data-asset-detail-id' );

			psi.patterns.ajaxRequest( {
				strElementSelector: '#modal_body',
				url: psi.objFixedAssets.arrstrExitTags['update_unretire_item'] + '&asset_transactions[asset_id]=' + intAssetId + '&asset_details[id]=' + intAssetDetailId
			});
		});

		$( '#create_place_in_service_button' ).on( 'click', function() {
			intFixedAssetId = $( '#asset_id' ).val();
			psi.patterns.loadDialog( { width: 600, height: 460, strUrl: psi.objFixedAssets.arrstrExitTags.create_placed_in_service + '&asset_id=' + intFixedAssetId, strContentId: 'create_placed_in_service', title: __('Place Item in Service') } );
			return false;
		});

		$( '#transfer_button' ).on( 'click', function() {
			intFixedAssetId = $( '#asset_id' ).val();
			psi.patterns.loadDialog( { width: 600, height: 460, strUrl: psi.objFixedAssets.arrstrExitTags.create_item_transfer + '&asset_id=' + intFixedAssetId + '&property_id=' + $('#hidden_asset_property_id').val()
					+ '&is_placed_in_service=' + $('#is_placed_in_service').val(), strContentId: 'create_transfer', title: __('Transfer Item') } );
			return false;
		});

		$( '.view_wo' ).click( function() {

			var intMainenanceRequestId	= $(this).data('wo-id');
			var intMainenanceRequestTypeId	= $(this).data('wo-type-id');

			var strPrefix = '';
			if( 1 == intMainenanceRequestTypeId ) {
				strPrefix = __( "Make Ready #{%d, key, nots}", { key : intMainenanceRequestId } );
			} else if( 2 == intMainenanceRequestTypeId ) {
				strPrefix = __( "Service Request #{%d, key, nots}", { key : intMainenanceRequestId } );
			} else {
				strPrefix = __( "Recurring #{%d, key, nots}", { key : intMainenanceRequestId } );
			}

			psi.patterns.addDialogContent({
				strUrl: psi.objFixedAssets.arrstrExitTags.customer_work_order_newxxx + '&maintenance_request[id]=' + intMainenanceRequestId,
				title: strPrefix,
				formSubmitContainerCheck: false,
				height: 'auto',
				width: 'auto'
			});
		});

		$(document).off( "click","#asset_edited" ).on("click","#asset_edited", function () {

			psi.patterns.loadDialog({ width:'800', height:'600', strUrl:psi.objFixedAssets.arrstrExitTags.view_edit_asset_history_log + '&event_id=' + $(this).data("event-id"), strContentId:'modal_id', title: __( 'View Edits' )});
			return false;
		});

		$(document).off( "click","#asset-created" ).on("click","#asset-created", function () {
            psi.patterns.addDialogContent({
                strUrl: psi.objFixedAssets.arrstrExitTags.view_purchase_order + '&ap_header[id]=' + $(this).data("ap-header-id"),
                title: __( 'View PO' ),
                formSubmitContainerCheck: false,
                height: 'auto',
                width: 'auto'
            });
       });

       $(document).off( "click","#invoice-created" ).on("click","#invoice-created", function () {
          psi.patterns.addDialogContent({
              strUrl: psi.objFixedAssets.arrstrExitTags.view_invoice + '&ap_header[id]=' + $(this).data("ap-header-id"),
                  title: __( 'View Invoice' ),
                  formSubmitContainerCheck: false,
                 height: 'auto',
                  width: 'auto'
            });
        });

		$(document).off( "click","#journal-entry-created" ).on("click","#journal-entry-created", function () {
			psi.patterns.addDialogContent({
				strUrl: psi.objFixedAssets.arrstrExitTags.view_gl_entry + '&gl_header[id]=' + $(this).data("gl-header-id"),
				title: __( 'View Journal Entry' ),
				formSubmitContainerCheck: false,
				height: 'auto',
				width: 'auto'
			});
		});

		$( document ).off( "click", "#asset-transaction-created" ).on( "click", "#asset-transaction-created", function () {
			psi.patterns.addDialogContent({
				strUrl: psi.objFixedAssets.arrstrExitTags.view_asset_transaction_association_history + '&asset_id=' + $(this).data("asset-id"),
				title: __( 'View Transactions' ),
				formSubmitContainerCheck: false,
				height: 'auto',
				width: 'auto'
			});
		});


	};

	var clickBulkTransferFixedAssets = function() {

		psi.patterns.loadLargeDialog( {
			strUrl: psi.objFixedAssets.arrstrExitTags.view_bulk_transfer_fixed_assets,
			title: __( 'Bulk Transfer Fixed Assets' )
		} );
	}

	// refresh fixed asset tab on updating data
	function reFreshFixedAssetsTab() {
				 psi.patterns.ajaxRequest( {
				 strElementSelector: '#div-view-listing',
				 url: psi.objViewAssetsListSystem.arrstrExitTags['view_assets_list'],
			 } );
				return false;
	 }

	return { init						: init,
			arrstrExitTags				: arrstrExitTags,
			fixedAssetsListing			: fixedAssetsListing,
			fixedAssetsLazyLoad			: fixedAssetsLazyLoad,
			clickHandlerWarrantyVendor	: clickHandlerWarrantyVendor,
			clickBulkTransferFixedAssets : clickBulkTransferFixedAssets,
			reFreshFixedAssetsTab : reFreshFixedAssetsTab
		};

} )();

psi.objRetireItem = ( function() {

	var arrstrExitTags = {};

	var init = function() {

		psi.patterns.bindEssentials();

		$( '#insert_retire_item_submit' ).click( function() {
			var intAssetId 		= $( this).attr( 'data-asset-id' );
			var intAssetDetailId = $( this).attr( 'data-asset-detail-id' );

			psi.patterns.ajaxRequest( {
				strElementSelector: '#create-retire-item',
				url: psi.objRetireItem.arrstrExitTags['insert_retire_item'] + '&asset_detail[asset_id]=' + intAssetId + '&asset_detail[id]=' + intAssetDetailId,
				data: $( '#add_retire_item_form' ).serialize()
			} );
		} );

		$( '#cancel_retire_item' ).click( function() {
			$( '#create-retire-item' ).dialog( 'close' );
			return false;
		} );

		$( '#post_month_retire' ).blur( function() {
			checkPostMonth( this );
		} );

		$( '#post_month_retire' ).change( function() {
			this.value = getValidFormattedPostMonth( $( this ).val() );
		} );

	};
	return { init			: init,
			 arrstrExitTags	: arrstrExitTags
	};

} )();

psi.objDepreciation = ( function() {

	var init = function() {

		$( '#depreciation_info-button' ).on( 'click', function() {
			if( false == $( '#depreciation_info-edit' ).is( ':visible' ) ) {

				$( '#depreciation_info-view' ).addClass( 'hide' );
				$( '#depreciation_info-edit' ).removeClass( 'hide' );
				$( '#depreciation_info-button' ).addClass( 'hide' );
				psi.patterns.stripesPattern( $( '[data-pattern=stripes]' ) )
			} else {
				$( '#depreciation_info-edit' ).addClass( 'hide' );
				$( '#depreciation_info-view' ).removeClass( 'hide' );
				$( '#depreciation_info-button' ).removeClass( 'hide' );
			}
		} );

		$( '#edit_depreciation' ).submit( function() {
			var strElementId = '#depreciation';
			window.reloadList = 1;
			psi.patterns.ajaxRequest( { strElementSelector: strElementId, url: psi.objFixedAssets.arrstrExitTags.view_update_depreciation + '&asset_id=' + $( '#asset_id' ).val(), data: $( '#edit_depreciation' ).serialize() } );
			return false;
		} );

		$( '#depreciation-cancel' ).on('click', function() {
			var strElementId = '#depreciation';
			window.reloadList = 1;
			psi.patterns.ajaxRequest( { strElementSelector: strElementId, url: psi.objFixedAssets.arrstrExitTags.view_update_depreciation + '&asset_id=' + $( '#asset_id' ).val() } );
			return false;
		} );

		$("#useful_life_months").keypress( function(event) {
    		if( 8 != event.which && 0 != event.which && ( 48 > event.which || 57 < event.which ) ) {
        		event.preventDefault();
               return false;
           }
		});

		$("#salvage_value").on( 'keypress' ,function(event) {
    		if( 45 == event.which || 189 == event.which ) {
        		event.preventDefault();
               return false;
           }
		});

		$( '#depreciation_category_id' ).on( 'change', function() {

			var intUsefulLifeMonth		= $( this ).find( 'option:selected' ).data( 'useful-life-months' );
			var strTaxRecoveryPeriodId	= $( this ).find( 'option:selected' ).data( 'tax-recovery-period-id' );
			$( '#tax_recovery_period' ).val(strTaxRecoveryPeriodId);
			$( '#useful_life_months' ).val( intUsefulLifeMonth );

		});

		$( '#salvage_value, #useful_life_months' ).on( 'blur', function() {

			fltSalvageValue 	= parseFloat($('#salvage_value').val());
			intUsefulLifeMonths	= $('#useful_life_months').val();
			fltPurchasePrice	= parseFloat(getCleanValue($('#purchase_price').html()));

			if( intUsefulLifeMonths < 0 ) {
				$('#monthly_depreciation').html( "-" );

			}
			strMonth = " Months";

			if( 1 >= intUsefulLifeMonths ) {
				strMonth =" Month";
			}
			fltDepreciableAmount 	= fltPurchasePrice - fltSalvageValue;
			fltMonthlyDepreciation	= fltDepreciableAmount / intUsefulLifeMonths;

			if( 0 == isNaN( fltSalvageValue ) ) {
				$('#salvage_value').val( fltSalvageValue.toFixed(2) );
				$('#salvage').html( '(' + i18nUtils.currency( fltSalvageValue ) +')' );
				$('#depreciable_amount').html( i18nUtils.currency( fltDepreciableAmount ) );
			} else {
				$('#salvage').html( '( - )' );
				$('#depreciable_amount').html( ' - ' );
			}

			$('#useful_life').html( intUsefulLifeMonths + strMonth );

			if( false == isFinite( fltMonthlyDepreciation ) ) {
				$( '#monthly_depreciation' ).html( "-" );
			} else {
				$( '#monthly_depreciation' ).html( i18nUtils.currency( fltMonthlyDepreciation ) );
			}
		} );
	};

	return { init : init };
} )();

psi.objPlaceInServiceAndTransferItem = ( function() {

	var arrstrExitTags = {};

	var init = function() {

		psi.patterns.bindEssentials();

		$( '#location_type' ).on( 'click', function() {

			$('#asset_container').hide();
			$('.retire_data').hide();
			$( '#post_month_retire' ).val( '' );
			$( '#post_date_retire' ).val( '' );
			$( '.post_date_format' ).val( '' )
			$( '#proceeds_from_sale' ).val( '' );

			$( '#hidden_maintenance_location_id' ).val( '' );
			$( '#locations_on_property' ).val( '' );
			$( '#locations_within_unit' ).val( '' );
			$( '#hidden_asset_unit_id' ).val( '' );
			$( '#hidden_asset_unit_name' ).val( '' );
			$( '#hidden_maintenance_location_name' ).val( '' );

			if( intLocationTypeProperty === $( '#location_type' ).val() ) {
				$('.unit').hide();
				$('.unit_space').hide();
				$('.unit_location').hide();
				$('.prop').fadeIn();
			} else if( intLocationTypeUnitSpace === $( '#location_type' ).val() ) {
				$('.unit_space').fadeIn('fast');
				$('.unit_location').fadeIn('fast');
				$('.prop').hide();
				$('.unit').hide();

			} else if( intLocationTypeUnit === $( '#location_type' ).val() ) {
				$('.unit').fadeIn('fast');
				$('.unit_location').fadeIn('fast');
				$('.prop').hide();
				$('.unit_space').hide();
			}

		} );

		$( '#asset_container' ).on( 'change', '#retire_asset', function() {

			$( '#post_month_retire' ).val( '' );
			$( '#post_date_retire' ).val( '' );
			$( '#proceeds_from_sale' ).val( '' );
			$( '.post_date_format' ).val( '' );

			if( 'none' == $(this).val() ) {
				$('.retire_data').hide();
			} else {
				$('.retire_data').show();
			}
		});

		$( '#place_in_service_submit' ).click( function() {

			psi.patterns.ajaxRequest( { strElementSelector: '#create_placed_in_service', url: psi.objPlaceInServiceAndTransferItem.arrstrExitTags['insert_placed_in_service'], data: $( '#add_place_in_service_frm' ).serialize() } );
		} );

		$( '#place_in_service_cancel' ).click( function() {

			$( '#create_placed_in_service' ).dialog( 'close' );
			return false;
		} );

		$( '#add_place_in_service_frm' ).submit( function() {
			return false;
		} );

		//Transfer Item
		$( '#transfer_item_submit' ).click( function() {

			psi.patterns.ajaxRequest( { strElementSelector: '#create_transfer', url: psi.objPlaceInServiceAndTransferItem.arrstrExitTags['insert_item_transfer'] + '&is_placed_in_service=' + $('#is_placed_in_service').val(), data: $( '#add_transfer_item_frm' ).serialize() } );
		} );

		$( '#transfer_item_cancel' ).click( function() {

			$( '#create_transfer' ).dialog( 'close' );
			return false;
		} );

		$( '#add_transfer_item_frm' ).submit( function() {
			return false;
		} );

		$( '#post_month-transfer' ).blur( function() {
			checkPostMonth( this );
		} );

		$( '#post_month-transfer' ).change( function() {
			this.value = getValidFormattedPostMonth( $( this ).val() );
		} );

		$( '#locations_on_property' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_locations',
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'locations_on_properties';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objPlaceInServiceAndTransferItem.clickHandlerLocationsOnProperty( objRowData, '#locations_on_property' );

				psi.objPlaceInServiceAndTransferItem.clickHandlerLoadAssets();
			}
		});

		$( '#asset_locations_on_property' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_asset_locations' + '&exclude_asset_location[id]=' + $('#hidden_exclude_asset_location_id').val(),
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'asset_locations_on_properties';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
				this.data['fast_lookup_filter[transfer_to_property_id]']	= $('#js-transfer-to-property-id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objPlaceInServiceAndTransferItem.clickHandlerLocationsOnProperty( objRowData, '#asset_locations_on_property' );
			}
		});

		$( '#locations_on_property' ).parent().addClass('left');
		$( '#asset_locations_on_property' ).parent().addClass('left');

		$( '#locations_within_unit' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_locations',
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'locations_within_unit';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objPlaceInServiceAndTransferItem.clickHandlerLocationsOnProperty( objRowData, '#locations_within_unit' );

				psi.objPlaceInServiceAndTransferItem.clickHandlerLoadAssets();
			}
		});
		$( '#locations_within_unit' ).parent().addClass('left');

		$( '#asset_units' ).entrataQuickSearch({
			url: psi.objPlaceInServiceAndTransferItem.arrstrExitTags['search_asset_units'],
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'fixed_assets_units';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objPlaceInServiceAndTransferItem.clickHandlerAssetUnits( objRowData, '#asset_units' );

				psi.objPlaceInServiceAndTransferItem.clickHandlerLoadAssets();
			}
		});
		$( '#asset_units' ).parent().addClass('left');

		$( '#asset_units_space' ).entrataQuickSearch({
			url: psi.objPlaceInServiceAndTransferItem.arrstrExitTags['search_asset_units'],
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']      = 'fixed_assets_units';
				this.data['fast_lookup_filter[property_id]']      = $('#hidden_asset_property_id').val();
				this.data['fast_lookup_filter[property_type_id]'] = $('#hidden_asset_property_type_id').val();
				this.data['fast_lookup_filter[is_student_property]'] = $('#hidden_asset_is_student_property').val();
			},
			onRowClick: function( objRowData ) {
				psi.objPlaceInServiceAndTransferItem.clickHandlerAssetUnits( objRowData, '#asset_units_space' );

				psi.objPlaceInServiceAndTransferItem.clickHandlerLoadAssets();
			}
		});

		$( '#asset_units_space' ).parent().addClass('left');

		// hide and show properties dropdown
		$('.js-new').off( 'click' ).on( 'click', function () {
			$('.js-prop').fadeIn();
			psi.patterns.stripesPattern('fieldset');
		});

		$('.js-current').off( 'click' ).on( 'click',function () {
			$('.js-prop').hide();
			psi.patterns.stripesPattern('fieldset');
		});
	};

	var quickSearchOnInventoryLocationsOnProperty = function() {
		$( '#inventory_locations_on_property' ).entrataQuickSearch({
			url: psi.objAssetListSearch.arrstrExitTags.search_asset_locations,
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]'] = 'inventory_locations_on_properties';
			},
			onRowClick: function( objRowData ) {
				psi.objPlaceInServiceAndTransferItem.clickHandlerLocationsOnProperty( objRowData, '#inventory_locations_on_property' );
			}
		});
	}

	var insertInventoryBulkTransfer = function() {
		psi.patterns.ajaxRequest( {
			strElementSelector: '#add_inventory_bulk_transfer_container',
			url: psi.objAssetListSearch.arrstrExitTags.insert_inventory_bulk_transfer + '&inventory_asset_id=' + $( '#insert_inventory_bulk_transfer' ).data( 'inventory-asset-id' ),
			data: $( '#inventory_bulk_transfer_form' ).serialize() + '&' + $( '.qty_to_transfer' ).serialize(),
			success: function( strParsedResponse ) {
				try{
					var responseArr = $.parseJSON( strParsedResponse );
					if( true === responseArr.success ) {
						$('#add_inventory_bulk_transfer_container').dialog('close');
						psi.patterns.closeLargeDialog();
						loadAssets();
					}
				} catch( e ) {
					$('.alert.error.slim').remove();
					$('#inventory_bulk_transfer_form').prepend( strParsedResponse );
					$('.alert.error.slim').addClass( 'margin5-top' );
				}
				psi.patterns.removeLoadingImage({ strElementSelector: '#add_inventory_bulk_transfer_container' });
			}
		} );
	}

	var clickHandlerLocationsOnProperty = function(obj, container ) {

		var strLocationName = __('Select Locations');

		$( container ).val( strLocationName );

		if( null != obj.name) {
			strLocationName = $("<div />").html( obj.name).text();
		}

		$( container ).val( strLocationName );
		$( container ).focus();

		if( '#asset_locations_on_property' == container ) {
			$( '#hidden_asset_location_id' ).val( obj.id );
			$( '#hidden_asset_location_name' ).val( strLocationName );
		} else if( '#inventory_locations_on_property' == container ) {
			$( '#hidden_inventory_asset_location_id' ).val( obj.id );
		} else {
			$( '#hidden_maintenance_location_id' ).val( obj.id );
			$( '#hidden_maintenance_location_name' ).val( strLocationName );
		}

	};

	var clickHandlerAssetUnits = function(obj, container ) {

		var strUnitNumber = __('Select Asset Units');

		$( container ).val( strUnitNumber );

		if( null != obj.unit_number ) {
			strUnitNumber = obj.unit_number;

			if( null != obj.building_name ) {
				strUnitNumber = obj.building_name+' - '+obj.unit_number;
			}
		}

		if( 1 == obj.is_student_property ) {
			if( null != obj.space_number ) {
				strUnitNumber = obj.unit_number+' - '+obj.space_number;
			} else {
				strUnitNumber = obj.unit_number;
			}
		}

		$( container ).val( strUnitNumber );
		$( container ).focus();

		$( '#hidden_asset_unit_id' ).val( obj.id );
		$( '#hidden_asset_unit_name' ).val( strUnitNumber );

	};

	var clickHandlerLoadAssets = function() {

		$('#asset_container').show();
		$('.retire_data').hide();
		$( '#post_month_retire' ).val( '' );
		$( '#post_date_retire' ).val( '' );
		$( '#proceeds_from_sale' ).val( '' );

		var strIsRetireAssetFrom = $('#hidden_is_retire_asset_from').val();
		var strFromName = '#add_place_in_service_frm';
		if( 'transfer_item' ===  strIsRetireAssetFrom ) {
			strFromName = '#add_transfer_item_frm';
		}
		psi.patterns.ajaxRequest({
			strElementSelector: "#load_assets_container",
			url: psi.objPlaceInServiceAndTransferItem.arrstrExitTags['load_assets'],
			data: $( strFromName ).serialize(),
			type: "POST",
			success: function( responseData ) {
				psi.patterns.removeLoadingImage({ strElementSelector: "#load_assets_container"});
				$("#asset_container").html(responseData);
			}
		});
	};

	return { init							: init,
		arrstrExitTags						: arrstrExitTags,
		clickHandlerAssetUnits				: clickHandlerAssetUnits,
		clickHandlerLocationsOnProperty		: clickHandlerLocationsOnProperty,
		insertInventoryBulkTransfer         : insertInventoryBulkTransfer,
		quickSearchOnInventoryLocationsOnProperty : quickSearchOnInventoryLocationsOnProperty,
		clickHandlerLoadAssets              : clickHandlerLoadAssets
	};

} )();

var getCleanValue = function( mixValue, intDecimalLimit ) {
	var objDecimalLimit = { decimalLimit: 2 };
	if( 'undefined' != typeof intDecimalLimit && 0 <= intDecimalLimit && 100 >= intDecimalLimit ) {
		objDecimalLimit.decimalLimit = intDecimalLimit;
	}
	var fltFinalValue = parseFloat( i18nUtils.getNumberUtils().getRawValue( String( mixValue ), objDecimalLimit ) );
	return isNaN( fltFinalValue ) ? 0.00 : fltFinalValue;
}
