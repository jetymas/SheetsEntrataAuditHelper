psi.objInventoryAdjustment = (function() {

	var arrstrExitTags	= {};
	var propertyTextValue	= '';
	var propertyTextId	= '';

	var clickHandlerApCodes = function(obj, container) {

		var strApCode = __('Select Catalog Item');

		$( container ).val( strApCode );

		if( null != obj.name ) {
			strApCode = $("<div />").html(obj.name).text();
		}

		$( container ).val( strApCode );

		$( '#hidden_ap_code_id' ).val( obj.id );
		$( '#hidden_ap_code_name' ).val( strApCode );

		$( '#selectedUnitOfMeasures' ).text( obj.base_unit_name );
		$( '#hidden_unit_of_measure_id' ).val( obj.unit_of_measure_id );
		$( '#hidden_unit_of_measure_name' ).val( obj.base_unit_name );
		$( '#hidden_asset_type_Id' ).val( obj.asset_type_id );
	};

	var clickHandlerNewInventoryProperty = function(obj, container) {

		var strInventoryProperty = __('Select Property');
		$( container ).val( strInventoryProperty );

		if( null != obj.property_name ) {
			strInventoryProperty = $("<div />").html(obj.property_name).text();
		}

		$( container ).val( strInventoryProperty );
		$( container ).focus();

		$( '#hidden_property_id' ).val( obj.id );
		$( '#hidden_property_name' ).val( strInventoryProperty );

		handlePopulateLocation();
	};

	var handlePopulateLocation = function() {

		if( '' != $.trim( $( '#inventory_property_id' ).val() ) || null != $( '#inventory_property_id' ).val() ) {
			var intSelectedPropertyId = $.trim( $( '#hidden_property_id' ).val() );

			if( 0 == intSelectedPropertyId.length ) {
				$( '#asset_locations' ).find( 'option:gt(0)' ).remove();
				$( '#hidden_asset_location_id' ).val( '' );
			}

			psi.patterns.ajaxRequest( {
				strElementSelector: '#location_div',
				url: arrstrExitTags['load_locations'],
				data: $('#hidden_property_id').serialize(),
				success: function(strResponse) {
					var responseArr = $.parseJSON( strResponse );

					$( "#asset_locations" ).children( 'option:not(:first)' ).remove();
					$( '.loading-overlay' ).hide();

					for(var i=0;i<responseArr['arrstrLocations'].length;i++) {
						// show the default asset as selected
						var strSelected = '';
						if( '1' == responseArr['arrstrLocations'][i].is_default_asset_location ) {
							strSelected = 'selected';
						}
						$( "#asset_locations" ).append($( "<option " + strSelected + "></option>" ).attr( "value", responseArr['arrstrLocations'][i].id).text(responseArr['arrstrLocations'][i].name ) );
					}
					$( '#txtPostMonth' ).val( responseArr['strPostMonth'] );
				},
			} );
		}
	}

	var handlePopulateUnitOfMeasure = function() {

		var intSelectedApCodeId = $.trim( $( '#hidden_ap_code_id' ).val() );

		if( 0 == intSelectedApCodeId.length ) {
			$( '#selectedUnitOfMeasures' ).text('-');
			$( '#hidden_unit_of_measure_id' ).val( '' );
			$( '#hidden_unit_of_measure_name' ).val( '' );
		}
	}

	var setPropertyData = function() {

		if( '' != $.trim( $( '#hidden_property_id' ).val() ) && propertyTextValue != $.trim( $( '#inventory_property_id' ).val() ) && '' != propertyTextValue && propertyTextId == $.trim( $( '#hidden_property_id' ).val() ) ) {
			$( '#hidden_property_name' ).val( '' );
			$( '#hidden_property_id' ).val( '' );

			var intSelectedPropertyId = $.trim( $( '#hidden_property_id' ).val() );

			if( 0 == intSelectedPropertyId.length ) {
				$( '#asset_locations' ).find( 'option:gt(0)' ).remove();
				$( '#txtPostMonth' ).val( '' );
			}
		}
	}

	var init = function() {

		$( '#txtQuantity' ).on( 'keydown', function (e) {

			var intKeycode = (e.which || e.keyCode);
			if( intKeycode == 110 || intKeycode == 190 ) {
				return false;
			}
		});

		$( '#txtQuantity' ).on( 'blur', function() {

			var intQuantity = parseInt( $(this).val() );
			if( false == $.isNumeric( intQuantity ) ) {
				$( '#txtQuantity' ).val( '' );
			}
		});

		$( '#unit_cost' ).on( 'blur', function() {

			var fltUnitCost = parseFloat( $(this).val() ).toFixed(2);
			if( '' == fltUnitCost || 0 == fltUnitCost || true == isNaN( fltUnitCost ) ) {
				$( '#unit_cost' ).val( '' );
			} else {
				$( '#unit_cost' ).val( fltUnitCost );
			}
		});

		$( '#inventory_property_id' ).on( 'change', function() {

			if( '' == $.trim( $('#inventory_property_id').val() ) ) {
				$( '#hidden_property_name' ).val( '' );
				$( '#hidden_property_id' ).val( '' );

				var intSelectedPropertyId = $.trim( $( '#hidden_property_id' ).val() );

				if( 0 == intSelectedPropertyId.length ) {
					$( '#asset_locations' ).find( 'option:gt(0)' ).remove();
					$( '#txtPostMonth' ).val( '' );
				}
			}
		});

		$( '#inventory_property_id' ).on( 'click', function() {
			propertyTextValue	= $.trim( $( '#inventory_property_id' ).val() );
			propertyTextId		= $.trim( $( '#hidden_property_id' ).val() );
		});

		$( '#inventory_select_item' ).on( 'change', function() {

			if( '' == $.trim( $('#inventory_select_item').val() ) ) {
				$( '#hidden_ap_code_name' ).val( '' );
				$( '#hidden_ap_code_id' ).val( '' );
			}
			handlePopulateUnitOfMeasure();
		});

		$( '#btnSubmit' ).click(function() {
			psi.patterns.ajaxRequest( { strElementSelector: '#add_inventory_adjustment', url: arrstrExitTags['insert_inventory_adjustment'], data: $('#add_inventory_adjustment_frm').serialize() } );
		});

		$( '#invntory_adjustment_cancel' ).on( 'click', function() {
			$( '#add_inventory_adjustment' ).dialog( 'close' );
			return false;
		} );

		$( '#inventory_property_id' ).entrataQuickSearch({
			url: '?module=purchase_ordersxxx&action=search_purchase_orders',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'inventory_adjustment_properties';
			},
			onRowClick: function( objRowData ) {
				psi.objInventoryAdjustment.clickHandlerNewInventoryProperty( objRowData, "#inventory_property_id" );
			}
		});
		$( '#inventory_property_id' ).parent().addClass('left');

		$( '#inventory_select_item' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_purchase_orders',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'inventory_ap_codes';
			},
			onRowClick: function( objRowData ) {
				psi.objInventoryAdjustment.clickHandlerApCodes( objRowData, "#inventory_select_item" );
			}
		});

		$( '#inventory_select_item' ).parent().addClass('left');

	};

	$( '#update_ap_details .js-post-month' ).blur( function() {
		$( this ).val( getValidFormattedPostMonth( $( this ).val() ) );
	});

	$( '#frm_return_items .js-post-month' ).blur( function() {
		$( this ).val( getValidFormattedPostMonth( $( this ).val() ) );
	});

	$( '#frm_update_items .js-post-month' ).blur( function() {
		$( this ).val( getValidFormattedPostMonth( $( this ).val() ) );
	});

	$( '#frm_update_items .js-post-month' ).keyup( function( e ) {
		if( e.keyCode == 13 )
			$( this ).val( getValidFormattedPostMonth( $( this ).val() ) );
	});

	$( '#frm_update_unreceive_items .js-post-month' ).blur( function() {
		$( this ).val( getValidFormattedPostMonth( $( this ).val() ) );
	});

	$( '#frm_update_unreceive_items .js-post-month' ).keyup( function( e ) {
		if( e.keyCode == 13 )
			$( this ).val( getValidFormattedPostMonth( $( this ).val() ) );
	});

	return {
		init								: init,
		arrstrExitTags						: arrstrExitTags,
		setPropertyData						: setPropertyData,
		handlePopulateLocation				: handlePopulateLocation,
		clickHandlerApCodes					: clickHandlerApCodes,
		handlePopulateUnitOfMeasure			: handlePopulateUnitOfMeasure,
		clickHandlerNewInventoryProperty	: clickHandlerNewInventoryProperty,
	};
})();

psi.objAddFixedAssets = (function() {

	var arrstrExitTags				= {};
	var strWarrantyVendorTextId		= '';
	var strWarrantyVendorTextValue	= '';
	var strAssetpropertyTextValue	= '';
	var strAssetpropertyTextId		= '';
	var handleResetPropertySelectionValue    = function() {
		if( psi.objAddFixedAssets.intUnitLocationTypeId == $('#location_type_id').val() ) {
			$( '#asset_units' ).val( '' );
			$( '#hidden_maintenance_location_id' ).val( '' );
			$( '#hidden_asset_transactions_locations_id' ).val( '' );
			$( '#hidden_maintenance_location_name' ).val( '' );
			$( '#locations_on_property' ).val( '' );
			$( '#locations_within_unit' ).val( '' );
			$( '#hidden_asset_transaction_unit_id' ).val( '' );
			$( '#hidden_asset_unit_id' ).val( '' );
			$( '#hidden_asset_unit_name' ).val( '' );
		}
		if( psi.objAddFixedAssets.intUnitSpaceLocationTypeId == $('#location_type_id').val() ) {
			$( '#asset_units_space' ).val( '' );
			$( '#hidden_maintenance_location_id' ).val( '' );
			$( '#hidden_asset_transactions_locations_id' ).val( '' );
			$( '#hidden_maintenance_location_name' ).val( '' );
			$( '#locations_on_property' ).val( '' );
			$( '#locations_within_unit' ).val( '' );
			$( '#hidden_asset_transaction_unit_id' ).val( '' );
			$( '#hidden_asset_unit_id' ).val( '' );
			$( '#hidden_asset_unit_name' ).val( '' );
		}

		if( psi.objAddFixedAssets.intPropertyLocationTypeId == $('#location_type_id').val() ) {
			$( '#hidden_maintenance_location_id' ).val( '' );
			$( '#hidden_asset_transactions_locations_id' ).val( '' );
			$( '#hidden_maintenance_location_name' ).val( '' );
			$( '#locations_on_property' ).val( '' );
			$( '#locations_within_unit' ).val( '' );
		}
	}
	var handleResetLocationType = function() {
		$( '#asset_units' ).val( '' );
		$( '#asset_units_space' ).val( '' );
		$( '#hidden_asset_transaction_unit_id' ).val( '' );
		$( '#hidden_asset_unit_id' ).val( '' );
		$( '#hidden_asset_unit_name' ).val( '' );
		$( '#hidden_maintenance_location_id' ).val( '' );
		$( '#hidden_asset_transactions_locations_id' ).val( '' );
		$( '#hidden_maintenance_location_name' ).val( '' );
		$( '#locations_on_property' ).val( '' );
		$( '#locations_within_unit' ).val( '' );
	}
	var handlePopulateAssetLocation = function() {

		if( '' != $.trim( $('#assets_property_id').val() ) || null != $( '#assets_property_id' ).val() ) {
			var intSelectedPropertyId = $.trim( $( '#hidden_asset_property_id' ).val() );

			if( 0 == intSelectedPropertyId.length ) {
				$( '#fixed_asset_locations' ).find( 'option:gt(0)' ).remove();
				$( '#hidden_fixed_asset_location_id' ).val( '' );
			}

			psi.patterns.ajaxRequest( {
				strElementSelector: '#asset_location_div',
				url: arrstrExitTags['load_locations'] + '&load_all_properties=1',
				data: $( '#add_fixed_assets_frm' ).serialize(),
				success: function( strResponse ) {
					var responseArr = $.parseJSON( strResponse );

					$( '#fixed_asset_locations' ).children( 'option:not(:first)' ).remove();
					$( '.loading-overlay' ).hide();

					for( var i = 0; i < responseArr['arrstrLocations'].length; i++ ) {
						// show the default asset as selected
						var strSelected = '';
						if( '1' == responseArr['arrstrLocations'][i].is_default_asset_location ) {
							strSelected = 'selected';
						}
						$( '#fixed_asset_locations' ).append( $( '<option ' + strSelected + '></option>' ).attr( 'value', responseArr['arrstrLocations'][i].id ).text( responseArr['arrstrLocations'][i].name ) );
					}
					$( '#txtPostMonth' ).val( responseArr['strPostMonth'] );

				},
			} );
		}
	}

	var clickHandlerFixedAssetsApCodes = function(obj, container) {
		var strApCode = __('Select Catalog Item');

		$( container ).val( strApCode );

		if( null != obj.name ) {
			strApCode = $("<div />").html( obj.name ).text();
		}

		$( container ).val( strApCode );

		$( '#hidden_asset_ap_code_id' ).val( obj.id );
		$( '#hidden_asset_ap_code_name' ).val( strApCode );
		$( '#hidden_unit_of_measure_id' ).val( obj.unit_of_measure_id );
		$( '#hidden_debit_gl_account_id' ).val( obj.debit_gl_account_id );
		$( '#hidden_credit_gl_account_id' ).val( obj.credit_gl_account_id );
		$( '#hidden_asset_transaction_ap_code_id' ).val( obj.id );
		$( '#hidden_depreciation_category_id' ).val( obj.depreciation_category_id );

		psi.objAddFixedAssets.loadCatalogItemDetails();

		if( psi.objAddFixedAssets.intAssetTypeId != obj.asset_type_id ) {
			psi.objAddFixedAssets.loadDepreciableCategory();
		} else {
			$( '#depreciation_category_div' ).addClass('hide');
			$( '#useful_life' ).addClass( 'hide' );
		}

	};

	var clickHandlerNewFixedAssetsProperty = function(obj, container) {

		var strInventoryProperty = __('Select Property');
		$( container ).val( strInventoryProperty );

		if( null != obj.property_name ) {
			strInventoryProperty = $("<div />").html( obj.property_name ).text();
		}

		$( container ).val( strInventoryProperty );
		$( container ).focus();

		$( '#hidden_asset_property_id' ).val( obj.id );
		$( '#hidden_asset_property_type_id' ).val( obj.property_type_id );
		$( '#hidden_asset_is_student_property' ).val( obj.is_student_property );

		$( '#hidden_asset_transaction_property_id' ).val( obj.id );
		$( '#hidden_asset_property_name' ).val( strInventoryProperty );

		var intSelectedPlacedInServiceValue = $.trim( $( '#placed_in_service_toggle_value' ).val() );

		if( 0 == intSelectedPlacedInServiceValue ) {
			$( '.unit' ).hide();
		} else {
			if( 1 == obj.is_student_property ) {
				$( '.location_type_'+this.intUnitSpaceLocationTypeId ).removeClass('hide');
				$( '.location_type_'+this.intUnitSpaceLocationTypeId ).prop( 'selected', true );
				$( '.js-unit-space' ).show();
				$( '.unit' ).show();
				$( '.js-unit' ).hide();
				$( '.prop' ).hide();

			} else {
				$( '.location_type_'+this.intUnitSpaceLocationTypeId ).addClass('hide');
				$( '.js-unit-space' ).hide();
				$( '.unit' ).show();
				$( '.prop' ).hide();
				$( '.location_type_'+this.intUnitSpaceLocationTypeId ).prop( 'selected', false );
				$( '.location_type_'+this.intUnitLocationTypeId ).prop( 'selected', true );

			}
		}
		handleResetPropertySelectionValue();
		handlePopulateAssetLocation();
	};

	var setWarrantyVendorDetails = function() {

		var strVendorValue			= $.trim( $( '#warranty_ap_payees_dropdown' ).val() );
		var apPayeesDropdownValues	= $( '#hidden_warranty_vendor_dropdown' ).val().split( '_' );
		var intApPayeeLocationId	= apPayeesDropdownValues[1];
		var intApPayeeId 			= apPayeesDropdownValues[0];

		if( '' != $.trim( $( '#hidden_ap_payees_dropdown' ).val() ) && strWarrantyVendorTextValue != $.trim( $( '#warranty_ap_payees_dropdown' ).val() ) && '' != strWarrantyVendorTextValue && strWarrantyVendorTextId == $.trim( $( '#hidden_warranty_vendor_dropdown' ).val() ) ) {
			$( '#hidden_warranty_vendor_dropdown' ).val( '' );
		}

		$( '#selected_warranty_vendor_id' ).val( intApPayeeId );
		$( '#selected_warranty_vendor_location_id' ).val( intApPayeeLocationId );
	};

	var clickHandlerWarrantyVendor = function(obj, container ) {

		var strPoVendor = __('Select Purchase Order Vendor');

		$( container ).val( strPoVendor );

		if( null != obj.company_name && '' != obj.company_name ) {
			strPoVendor = obj.company_name;
		}

		if( null != obj.location_name && '' != obj.location_name ) {
			strPoVendor = strPoVendor + ', ' + obj.location_name;
		}

		if( null != obj.city && '' != obj.city ) {
			strPoVendor = strPoVendor + ', ' + obj.city;
		}

		if( null != obj.state_code && '' != obj.state_code ) {
			strPoVendor = strPoVendor + ', ' + obj.state_code;
		}

		$( container ).val( strPoVendor );
		$( container ).focus();

		var strapPayeeDropdown = obj.id + '_' + obj.ap_payee_location_id;

		$( '#hidden_warranty_vendor_dropdown' ).val( strapPayeeDropdown );

		setWarrantyVendorDetails();
	};

	var clickHandlerLocationsOnProperty = function(obj, container ) {

		var strLocationName = __('Select Locations');

		$( container ).val( strLocationName );

		if(null != obj.name) {
			strLocationName = $("<div />").html( obj.name).text();
		}

		$( container ).val( strLocationName );
		$( container ).focus();

		$( '#hidden_maintenance_location_id' ).val( obj.id );
		$( '#hidden_maintenance_location_name' ).val( strLocationName );
		$( '#hidden_asset_transactions_locations_id' ).val( obj.id );

	};

	var clickHandlerAssetUnits = function(obj, container ) {

		var strUnitNumber = __('Select Asset Units');

		$( container ).val( strUnitNumber );

		if( null != obj.unit_number ) {
			strUnitNumber = obj.unit_number;

			if( null != obj.building_name ) {
				strUnitNumber = obj.building_name+' - '+obj.unit_number;
			}

			if( 1 == obj.is_student_property ) {
				if( null != obj.space_number ) {
					strUnitNumber = obj.unit_number+' - '+obj.space_number;
				} else {
					strUnitNumber = obj.unit_number;
				}
			}

		}
		$( container ).val( strUnitNumber );
		$( container ).focus();

		$( '#hidden_asset_unit_id' ).val( obj.id );
		$( '#hidden_asset_transaction_unit_id' ).val( obj.id );
		$( '#hidden_asset_unit_name' ).val( strUnitNumber );

	};

	var setFixedAssetPropertyData = function() {

		if( '' != $.trim( $( '#hidden_asset_property_id' ).val() ) && strAssetpropertyTextValue != $.trim( $( '#hidden_asset_property_id' ).val() ) && '' != strAssetpropertyTextValue && strAssetpropertyTextId == $.trim( $( '#hidden_asset_property_id' ).val() ) ) {

			$( '#hidden_asset_property_name' ).val( '' );
			$( '#hidden_asset_property_id' ).val( '' );

			var intSelectedPropertyId = $.trim( $( '#hidden_asset_property_id' ).val() );

			if( 0 == intSelectedPropertyId.length ) {
				$( '#asset_locations' ).find( 'option:gt(0)' ).remove();
				$( '#txtPostMonth' ).val( '' );
				$( '#useful_life_months' ).val( '' );
				$( '#asset_units' ).val( '' );
				$( '#hidden_asset_unit_id' ).val( '' );
				$( '#hidden_asset_transaction_unit_id' ).val( '' );
			}
		}
	};

	var loadDepreciableCategory = function() {

		psi.patterns.ajaxRequest( {
			strElementSelector: '#depreciation_category_div',
			url: arrstrExitTags['load_depreciation_categories'],
			data: $( '#add_fixed_assets_frm' ).serialize(),
			success: function( strResponse ) {
				var responseArr = $.parseJSON( strResponse );
				$( "#depreciation_category_div" ).removeClass( 'hide' ).addClass( "aRow" );
				$( "#depreciation_category_name " ).html( responseArr.depreciation_category_name );
				$( "#hidden_tax_recovery_period_id").val( responseArr.tax_recovery_period_id );
				if( false == responseArr.is_depreciable ) {
					$( "#useful_life").addClass( 'hide' );
				} else {
					$( "#useful_life").removeClass( 'hide' ).addClass( "bRow" ).removeAttr( 'style' );
					$( "#useful_life_months" ).val( responseArr.useful_life_month );
				}

				psi.patterns.removeLoadingImage( { strElementSelector: '#depreciation_category_div' } );
			}
		} );
	}

	var loadCatalogItemDetails = function() {
		psi.patterns.ajaxRequest( {
			strElementSelector: '#service_life',
			url: arrstrExitTags['load_catalog_item_details'],
			data: $( '#add_fixed_assets_frm' ).serialize(),
			success: function( strResponse ) {
				var responseArr = $.parseJSON( strResponse );

				$( "#service_life").removeClass( 'hide' ).addClass( "bRow" ).removeAttr( 'style' );
				$( "#service_life_months" ).val( responseArr.service_life_months );

				psi.patterns.removeLoadingImage( { strElementSelector: '#service_life' } );
			}
		} );
	}

	var init = function() {

		$( '#placed_in_service_toggle' ).on( 'click', function() {
			$( '.placed' ).toggle();
			$( '.location' ).toggle();

			var intSelectedPropertyIsStudentProperty = $.trim( $( '#hidden_asset_is_student_property' ).val() );

			$( '.unit, .unit-space, .prop' ).hide();

			if( 0 == $('#placed_in_service_toggle_value').val() ) {

				if( 1 == intSelectedPropertyIsStudentProperty  ) {
					$( '.location_type_'+psi.objAddFixedAssets.intUnitSpaceLocationTypeId ).show();
					$( '.location_type_'+psi.objAddFixedAssets.intUnitSpaceLocationTypeId ).prop( 'selected', true );
				} else {
					$( '.location_type_'+psi.objAddFixedAssets.intUnitSpaceLocationTypeId ).prop( 'selected', false );
					$( '.location_type_'+psi.objAddFixedAssets.intUnitSpaceLocationTypeId ).hide();
					$( '.unit-space' ).hide('fast');
				}

					if( psi.objAddFixedAssets.intPropertyLocationTypeId == $('#location_type_id').val() ){

					$( '.unit, .unit-space' ).hide('fast');
					$( '.prop' ).fadeIn();
					} else if( psi.objAddFixedAssets.intUnitLocationTypeId == $('#location_type_id').val() ) {

					$( '.unit' ).fadeIn('fast');
					$( '.prop, .unit-space' ).hide('fast');
					} else if( psi.objAddFixedAssets.intUnitSpaceLocationTypeId == $('#location_type_id').val() ) {

						$( '.unit-space, .unit' ).fadeIn('fast');
						$( '.prop, .js-unit' ).hide();
					}
			}

		});

		$('.js-method').on('change', function() {
				if( psi.objAddFixedAssets.intUnitLocationTypeId == $('#location_type_id').val() ) {
				$( '.unit' ).fadeIn( 'fast' );
				$( '.prop' ).hide();
			}
			if( psi.objAddFixedAssets.intUnitSpaceLocationTypeId == $('#location_type_id').val() ) {
				$( '.unit' ).fadeIn( 'fast' );
				$( '.js-unit' ).hide();
				$( '.prop' ).hide();
				}

				if( psi.objAddFixedAssets.intPropertyLocationTypeId == $('#location_type_id').val() ) {
					$( '.unit' ).hide();
					$( '.prop' ).fadeIn();
					}
			handleResetLocationType();
		});

		$( "#add_vendor" ).on( 'click', function() {

			psi.patterns.loadDialog( {
				width: 600,
				height: 460,
				strUrl: arrstrExitTags['quick_add_vendor'],
				strContentId: 'quick_add_vendor',
				title: __('Create New Vendor')
			} );
			return false;
		});

		$( '#warranty_ap_payees_dropdown' ).on( 'click', function() {
			strWarrantyVendorTextValue	= $.trim( $( '#warranty_ap_payees_dropdown' ).val() );
			strWarrantyVendorTextId		= $.trim( $( '#hidden_warranty_vendor_dropdown' ).val() );
		});

		$( '#warranty_ap_payees_dropdown' ).on( 'change', function() {
			setWarrantyVendorDetails();
		});

		$( '#btn_add_fixed_assets' ).on( 'click', function() {
			var strData = $( '#add_fixed_assets_frm' ).serialize();
			if( true == psi.objAddFixedAssets.boolIsFromApTransactions ) {
			strData += '&'+ $( '#frm-create-asset-from-transactions' ).serialize();
			}
			psi.patterns.ajaxRequest( {
				strElementSelector: '#add_fixed_assets',
				url: arrstrExitTags['insert_fixed_assets'] + '&load_all_properties=1',
				data: strData,
				success: function( response ) {
					$( "#add_fixed_assets").html( response );
					psi.patterns.removeLoadingImage( { strElementSelector: '#add_fixed_assets' } );
				}
			} );
		})

		$( '#assets_property_id' ).on( 'click', function() {
			strAssetpropertyTextValue	= $.trim( $( '#assets_property_id' ).val() );
			strAssetpropertyTextId		= $.trim( $( '#hidden_asset_property_id' ).val() );
		});

		$( '#transaction_amount' ).on( 'blur', function() {
			$( '#unit_cost' ).val( $( this ).val() );
		});

		$('#asset_conditon_dropdown').on( 'change', function() {
			$( '#hidden_asset_condition_id' ).val( $( this ).val() );
		} );

		$('#btn_cancel_fixed_assets').on( 'click', function() {
			$( '#add_fixed_assets' ).dialog( 'close' );
			return false;
		} )

		$( '#assets_property_id' ).on( 'change', function() {

			if( '' == $.trim( $('#assets_property_id').val() ) ) {
				$( '#hidden_asset_property_name' ).val( '' );
				$( '#hidden_asset_property_id' ).val( '' );

				var intSelectedPropertyId = $.trim( $( '#hidden_asset_property_id' ).val() );

				if( 0 == intSelectedPropertyId.length ) {
					$( '#fixed_asset_locations' ).find( 'option:gt(0)' ).remove();
					$( '#txtPostMonth' ).val( '' );
					$( '#useful_life_months' ).val( '' );
					$( '#asset_units' ).val( '' );
					$( '#hidden_asset_unit_id' ).val( '' );
					$( '#hidden_asset_transaction_unit_id' ).val( '' );
				}
			}
		});

		$( '#assets_property_id' ).entrataQuickSearch({
			url: '?module=purchase_ordersxxx&action=search_purchase_orders',
			containerClass: 'fast-lookup fl-dafault clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'fixed_assets_properties';
				this.data['fast_lookup_filter[property_id]']	= $('#assets_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerNewFixedAssetsProperty( objRowData, '#assets_property_id' );
			}
		});
		$( '#assets_property_id' ).parent().addClass('left');

		$( '#assets_ap_code_id' ).entrataQuickSearch({
			url: '?module=purchase_ordersxxx&action=search_purchase_orders',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function( obj ) {
				this.data['fast_lookup_filter[lookup_type]']			= 'fixed_assets_ap_codes';
				this.data['fast_lookup_filter[allocation_method_id]']	= $( '#assets_ap_code_id' ).val()
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerFixedAssetsApCodes( objRowData, '#assets_ap_code_id' );

			}
		});
		$( '#assets_ap_code_id' ).parent().addClass('left');

		$( '#warranty_ap_payees_dropdown' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_warranty_vendors',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'vendors_with_warranty_contacts';
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerWarrantyVendor( objRowData, '#warranty_ap_payees_dropdown' );
			}
		});
		$( '#warranty_ap_payees_dropdown' ).parent().addClass('left');

		$( '#locations_on_property' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_locations',
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'locations_on_properties';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerLocationsOnProperty( objRowData, '#locations_on_property' );
			}
		});
		$( '#locations_on_property' ).parent().addClass('left');

		$( '#locations_within_unit' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_locations',
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'locations_within_unit';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerLocationsOnProperty( objRowData, '#locations_within_unit' );
			}
		});
		$( '#locations_within_unit' ).parent().addClass('left');

		$( '#asset_units' ).entrataQuickSearch({
			url: psi.objAddFixedAssets.arrstrExitTags['search_asset_units'],
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'fixed_assets_units';
				this.data['fast_lookup_filter[property_id]']	= $('#hidden_asset_property_id').val();
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerAssetUnits( objRowData, '#asset_units' );
			}
		});
		$( '#asset_units' ).parent().addClass('left');

		$( '#asset_units_space' ).entrataQuickSearch({
			url: psi.objAddFixedAssets.arrstrExitTags['search_asset_units'],
			containerClass: 'fast-lookup fl-small clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	    = 'fixed_assets_units';
				this.data['fast_lookup_filter[property_id]']	    = $('#hidden_asset_property_id').val();
				this.data['fast_lookup_filter[property_type_id]']	= $('#hidden_asset_property_type_id').val();
				this.data['fast_lookup_filter[is_student_property]'] = $('#hidden_asset_is_student_property').val();
			},
			onRowClick: function( objRowData ) {
				psi.objAddFixedAssets.clickHandlerAssetUnits( objRowData, '#asset_units_space' );
			}
		});
		$( '#asset_units_space' ).parent().addClass('left');

		$( '#assets_ap_code_id' ).blur( function() {
			if( !$(this).val() ) {
				$( '#hidden_asset_ap_code_id' ).val( '' );
				$( '#hidden_asset_ap_code_name' ).val( '' );
				$( '#hidden_unit_of_measure_id' ).val( '' );
				$( '#hidden_debit_gl_account_id' ).val( '' );
				$( '#hidden_credit_gl_account_id' ).val( '' );
				$( '#hidden_asset_transaction_ap_code_id' ).val( '' );
				$( '#hidden_depreciation_category_id' ).val( '' );
			}
		});
	};

	return {
		init								: init,
		arrstrExitTags						: arrstrExitTags,
		clickHandlerAssetUnits				: clickHandlerAssetUnits,
		setFixedAssetPropertyData			: setFixedAssetPropertyData,
		clickHandlerWarrantyVendor 			: clickHandlerWarrantyVendor,
		handlePopulateAssetLocation			: handlePopulateAssetLocation,
		clickHandlerLocationsOnProperty		: clickHandlerLocationsOnProperty,
		clickHandlerFixedAssetsApCodes		: clickHandlerFixedAssetsApCodes,
		clickHandlerNewFixedAssetsProperty	: clickHandlerNewFixedAssetsProperty,
		loadDepreciableCategory             : loadDepreciableCategory,
		loadCatalogItemDetails              : loadCatalogItemDetails
	}
})();

psi.objQuickAddVendor = (function() {

	var arrstrExitTags		= {};
	var vendorTextId		= '';
	var vendorTextValue		= '';

	var setVendorDetails = function() {
		var strVendorValue			= $.trim( $( '#ap_payees_dropdown' ).val() ),
			strVendorHiddenId		= $.trim( $( '#hidden_ap_payees_dropdown' ).val() );
		var apPayeesDropdownValues	= $( '#hidden_ap_payees_dropdown' ).val().split( '_' );
		var intApPayeeLocationId	= apPayeesDropdownValues[1];
		var intApPayeeId 			= apPayeesDropdownValues[0];

		if( '' != $.trim( $( '#hidden_ap_payees_dropdown' ).val() ) && vendorTextValue != $.trim( $( '#ap_payees_dropdown' ).val() ) && '' != vendorTextValue && vendorTextId == $.trim( $( '#hidden_ap_payees_dropdown' ).val() ) ) {
			$('#hidden_ap_payees_dropdown').val( '' );
		}

		$( '#selected_ap_payee_id' ).val(intApPayeeId);
		$( '#selected_ap_payee_location_id' ).val(intApPayeeLocationId);
	};

	var clickHandlerNewVendor = function(obj, container) {

		var strPoVendor = __('Select Purchase Order Vendor');

		$( container ).val( strPoVendor );

		if( null != obj.company_name && '' != obj.company_name ) {
			strPoVendor = obj.company_name;
		}

		if( null != obj.location_name && '' != obj.location_name ) {
			strPoVendor = strPoVendor + ', ' + obj.location_name;
		}

		if( null != obj.city && '' != obj.city ) {
			strPoVendor = strPoVendor + ', ' + obj.city;
		}

		if( null != obj.state_code && '' != obj.state_code ) {
			strPoVendor = strPoVendor + ', ' + obj.state_code;
		}

		$( container ).val( strPoVendor );
		$( '#selected_ap_payee_name' ).val( strPoVendor );
		$( container ).focus();

		var strapPayeeDropdown = obj.id + '_' + obj.ap_payee_location_id;

		$( '#hidden_ap_payees_dropdown' ).val( strapPayeeDropdown );

		setVendorDetails();
	};

	var loadStates = function(){
		var strCountryCode			= $( '#contact_country_code' ).val();
		var strDynamicElements		= '';
		psi.patterns.ajaxRequest( {
			url: psi.objQuickAddVendor.arrstrExitTags['show_states'] + '&country_code=' + strCountryCode,
			dataType: 'json',
			success: function( arrobjResponse ) {
				strDynamicElements = psi.objQuickAddVendor.createStates( arrobjResponse )
				$( '#contact_state_code' ).find( 'option' ).remove().end().append( strDynamicElements );
				$( '[id^="contact_state_code"]' ).find( 'option' ).remove().end().append( strDynamicElements );
			}
		} );
		psi.objQuickAddVendor.showProvince( 'contact_country_code' );
	}

	var createStates = function( arrmixStates ){
		var strCountryCode			= $( '#contact_country_code' ).val();
		var strDynamicElements		= '';
		for( var key in arrmixStates ) {
			if( arrmixStates.valueOf( key ) ) {
				strDynamicElements += '<option value=\'' + key + '\'> ' + key + '</option>';
			}
		}
		return strDynamicElements;
	}

	var showProvince = function( selectorId ){
		if( 'US' == $( '#' + selectorId ).val() || 'CA' == $( '#' + selectorId ).val() ) {
			$( '#contact_state_code' ).show();
			$( '.province_text' ).hide();
			$( '.province_constraint' ).hide();
		} else {
			$( '.province_text' ).show();
			$( '.province_constraint' ).show();
			$( '#contact_state_code' ).hide();
		}
	}

	var init = function() {

		psi.objQuickAddVendor.loadStates();

		$( '#add_warranty_contact' ).on( 'click', function() {
			$( '#existing' ).hide();
			$( '#new' ).fadeIn( 'fast' );
		});

		$( '#create_new_warranty_vendor' ).on( 'click', function() {
			$( '#existing' ).fadeIn( 'fast' );
			$( '#new' ).hide();
		});

		$( '#btn_quick_add').on( 'click', function() {

			if( 0 < $( '.selected_for_add_vendor' ).length ) {
				strUniqueId = $( '[id^=warranty_ap_payees_dropdown_].selected_for_add_vendor' ).data( 'unique-id' );
				$( '[id^=warranty_ap_payees_dropdown_].selected_for_add_vendor' ).val( $( '#ap_payees_dropdown' ).val() ).focus();
				$( '#selected_warranty_vendor_id_' + strUniqueId ).val( $( '#selected_ap_payee_id' ).val() );
			} else {

				strVendor	= '';
				strVendorId	= '';
				strAddress	= '';
				strContact	= '';
				strPhone	= '';
				strEmail	= '';

				objSelectedVendor						= {};
				objSelectedVendor.street_line1			= $( '#contact_street_line1' ).val();
				objSelectedVendor.street_line2			= $( '#contact_street_line2' ).val();
				objSelectedVendor.city					= $( '#contact_city' ).val();
				objSelectedVendor.state_code			= $( '#contact_state_code' ).val();
				objSelectedVendor.postal_code			= $( '#contact_postal_code' ).val();
				objSelectedVendor.province			    = $( '#contact_province' ).val();
				objSelectedVendor.country_code			= $( '#contact_country_code option:selected' ).text();
				objSelectedVendor.phone_number			= $( '#contact_phone_number' ).val();
				objSelectedVendor.email_address			= $( '#contact_email_address' ).val();
				objSelectedVendor.name_first			= $( '#contact_name_first' ).val();
				objSelectedVendor.name_last				= $( '#contact_name_last' ).val();
				objSelectedVendor.ap_payee_location_id	= $( '#selected_ap_payee_location_id' ).val();

				strVendor								= $( '#ap_payees_dropdown' ).val();
				strVendorId								= $( '#selected_ap_payee_id' ).val();

				if( null != objSelectedVendor.street_line1 && '' != objSelectedVendor.street_line1 ) {
					strAddress = strAddress + objSelectedVendor.street_line1;
				}

				if( null != objSelectedVendor.street_line2 && '' != objSelectedVendor.street_line2 ) {
					strAddress = strAddress + ', ' + objSelectedVendor.street_line2;
				}

				if( null != objSelectedVendor.country_code && '' != objSelectedVendor.country_code ) {
					strAddress = strAddress + '<br> ' + objSelectedVendor.country_code;
				}

				if( null != objSelectedVendor.city && '' != objSelectedVendor.city ) {
					strAddress = strAddress + '<br> ' + objSelectedVendor.city;
				}

				if( null != objSelectedVendor.state_code && '' != objSelectedVendor.state_code ) {
					strAddress = strAddress + ', ' + objSelectedVendor.state_code;
				}

				if( null != objSelectedVendor.province && '' != objSelectedVendor.province ) {
					strAddress = strAddress + ', ' + objSelectedVendor.province;
				}

				if( null != objSelectedVendor.postal_code && '' != objSelectedVendor.postal_code ) {
					strAddress = strAddress + ', ' + objSelectedVendor.postal_code;
				}

				if( null != objSelectedVendor.name_first && '' != objSelectedVendor.name_first ) {
					strContact = objSelectedVendor.name_first;
				}

				if( null != objSelectedVendor.name_last && '' != objSelectedVendor.name_last ) {
					strContact = strContact + ' ' + objSelectedVendor.name_last;
				}

				if( null != objSelectedVendor.phone_number && '' != objSelectedVendor.phone_number ) {
					strPhone = objSelectedVendor.phone_number;
				}
				if( null != objSelectedVendor.email_address && '' != objSelectedVendor.email_address ) {
					strEmail = strEmail + ' ' + objSelectedVendor.email_address;
				}

				$( '#warranty_ap_payees_dropdown' ).val( strVendor );
				$( '#selected_warranty_vendor_id' ).val( strVendorId );

				$( '#warranty_vendor_address' ).html( strAddress );
				$( '#warranty_vendor_contact' ).text( strContact );
				$( '#warranty_vendor_phone' ).text( strPhone );
				$( '#warranty_vendor_email' ).text( strEmail );

				$( '#selected_warranty_vendor_location_id' ).val( objSelectedVendor.ap_payee_location_id );
				$( '#hidden_warranty_vendor_dropdown' ).val( strVendorId + '_' + objSelectedVendor.ap_payee_location_id );
			}

			psi.patterns.ajaxRequest( {
				strElementSelector: '#quick_add_vendor',
				url: arrstrExitTags['insert_quick_add_vendor'],
				data: $( '#quick_add_vendor_frm' ).serialize()
			} );
		} );

		$( '#ap_payees_dropdown' ).entrataQuickSearch({
			url: '?module=assets_trackingxxx&action=search_warranty_vendors',
			containerClass: 'fast-lookup fl-default clear',
			lazyLoad: 0,
			beforeRequestSend: function() {
				this.data['fast_lookup_filter[lookup_type]']	= 'vendors_without_warranty_contacts';
			},
			onRowClick: function( objRowData ) {
				psi.objQuickAddVendor.clickHandlerNewVendor( objRowData, '#ap_payees_dropdown' );
			}
		});
		$( '#ap_payees_dropdown' ).parent().addClass('left');

		$( '#ap_payees_dropdown' ).on( 'click', function() {
			vendorTextValue 	= $.trim( $( '#ap_payees_dropdown' ).val() );
			vendorTextId 		= $.trim( $( '#hidden_ap_payees_dropdown' ).val() );
		});

		$( '#ap_payees_dropdown' ).on( 'change', function() {
			setVendorDetails();
		});

		$( '#quick_add_cancel' ).on( 'click', function(){
			$( 'input[id^=hidden_warranty_vendor_dropdown]' ).val( '' );
			$( 'input[id^=selected_warranty_vendor_location_id]' ).val( '' );
			$( 'input[id^=selected_warranty_vendor_id]' ).val( '' );
			$( 'input[id^=warranty_ap_payees_dropdown]' ).val( '' );
			$('#quick_add_vendor').dialog('close');
			return false;
		} );

		$( '.ui-button.ui-widget.ui-state-default.ui-corner-all.ui-button-icon-only.ui-dialog-titlebar-close' ).click( function() {
			$( 'input[id^=hidden_warranty_vendor_dropdown]' ).val( '' );
			$( 'input[id^=selected_warranty_vendor_location_id]' ).val( '' );
			$( 'input[id^=selected_warranty_vendor_id]' ).val( '' );
			$( 'input[id^=warranty_ap_payees_dropdown]' ).val( '' );
		});

		$( '#ap_payees_dropdown' ).on( 'blur', function() {
			if( '' == $( this ).val() ) {
				$( '#selected_ap_payee_id' ).val( '' );
				$( '#selected_ap_payee_location_id' ).val( '' );
				$( '#hidden_ap_payees_dropdown' ).val( '' );
			}
		} );

		$( '.country_code' ).on( 'change', function() {
			psi.objQuickAddVendor.loadStates();
		});

	};

	return {
		init					: init,
		arrstrExitTags			: arrstrExitTags,
		setVendorDetails 		: setVendorDetails,
		clickHandlerNewVendor	: clickHandlerNewVendor,
		loadStates              : loadStates,
		createStates            : createStates,
		showProvince            : showProvince
	}
})();
